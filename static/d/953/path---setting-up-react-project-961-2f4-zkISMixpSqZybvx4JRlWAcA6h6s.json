{"data":{"site":{"siteMetadata":{"title":"YShean Dev Log","author":"Yong Shean"}},"markdownRemark":{"id":"51426ca8-b79d-5768-a38a-b9aa22f79a7d","excerpt":"Disclaimer: I’ve only started to document the process at the end of it (because I did NOT expect it to be this difficult!), so following the exact steps might…","html":"<p>Disclaimer: I’ve only started to document the process at the end of it (because I did NOT expect it to be this difficult!), so following the exact steps <em>might</em> not work. Anyway, I’ve included the end result (you can find in the GitHub link), and also the pages which I referred when I was setting up.</p>\n<p>Our toolbelt:</p>\n<ul>\n<li>React</li>\n<li>Typescript</li>\n<li>Linting &#x26; formatting</li>\n<li>Apollo GraphQL</li>\n<li>Jest (testing)</li>\n<li>Storybook (documentation)</li>\n</ul>\n<h2>Create React App (with Typescript)</h2>\n<p>Well, of course we will start with the original <code class=\"language-text\">create-react-app</code> utility — a great tool by React team to kickstart any React project! This is the easiest step, haha!</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx create-react-app <span class=\"token operator\">&lt;</span>your_app_name_here<span class=\"token operator\">></span> --typescript</code></pre></div>\n<h2>Linting and Formatting</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> --dev eslint-config-prettier eslint-plugin-prettier prettier</code></pre></div>\n<h2>Setting up Apollo GraphQL</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> @apollo/react-hooks\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> --exact apollo-boost\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> --exact graphql\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> --exact graphql.macro\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> --exact react react-dom\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> --exact react-apollo</code></pre></div>\n<p>// 263 git remote add origin <a href=\"https://github.com/yshean/cra-bootstrap.git\">https://github.com/yshean/cra-bootstrap.git</a></p>\n<h2>Setting up Storybook</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">npx -p @storybook/cli sb init -f</code></pre></div>\n<p>Since I’m going to use Typescript, I will follow the instruction <a href=\"https://storybook.js.org/docs/configurations/typescript-config/\">here</a>. There seems to be a few ways to achieve the same, I will be using the recommended way <em>Setting up TypeScript with awesome-typescript-loader</em>.</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D typescript\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D awesome-typescript-loader\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D @types/storybook__react <span class=\"token comment\"># typings</span>\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D @storybook/addon-info react-docgen-typescript-loader <span class=\"token comment\"># optional but recommended</span>\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D jest <span class=\"token string\">\"@types/jest\"</span> ts-jest <span class=\"token comment\">#testing</span></code></pre></div>\n<p>Also we need to add <code class=\"language-text\">tsconfig.json</code> (not really sure whether this file is required since there is already one inside the main project folder) and <code class=\"language-text\">webpack.config.js</code> into <code class=\"language-text\">.storybook</code> folder.</p>\n<p><code class=\"language-text\">tsconfig.json</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"compilerOptions\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"outDir\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"build/lib\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"module\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"commonjs\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"target\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"es5\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"lib\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"es5\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"es6\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"es7\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"es2017\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"dom\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"sourceMap\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"allowJs\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"jsx\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"react\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"moduleResolution\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"node\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"rootDirs\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"src\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"stories\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"baseUrl\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"src\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"forceConsistentCasingInFileNames\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"noImplicitReturns\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"noImplicitThis\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"noImplicitAny\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"strictNullChecks\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"suppressImplicitAnyIndexErrors\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"noUnusedLocals\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"declaration\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"allowSyntheticDefaultImports\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"experimentalDecorators\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"emitDecoratorMetadata\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"include\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"src/**/*\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"exclude\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"node_modules\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"build\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"scripts\"</span><span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><code class=\"language-text\">webpack.config.js</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">module<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> config <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  config<span class=\"token punctuation\">.</span>module<span class=\"token punctuation\">.</span>rules<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.(ts|tsx)$/</span><span class=\"token punctuation\">,</span>\n    use<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        loader<span class=\"token punctuation\">:</span> require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"awesome-typescript-loader\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// Optional</span>\n      <span class=\"token punctuation\">{</span>\n        loader<span class=\"token punctuation\">:</span> require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"react-docgen-typescript-loader\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  config<span class=\"token punctuation\">.</span>resolve<span class=\"token punctuation\">.</span>extensions<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".ts\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".tsx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token keyword\">return</span> config<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Our project uses absolute path (with a defined <code class=\"language-text\">baseDir</code>), for storybook to resolve and find our modules by absolute path, we need to install the following package:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D tsconfig-paths-webpack-plugin</code></pre></div>\n<p>Then add these two lines inside <code class=\"language-text\">webpack.config.js</code> that we’ve just created:</p>\n<div class=\"gatsby-highlight has-highlighted-lines\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"gatsby-highlight-code-line\"><span class=\"token keyword\">const</span> TsconfigPathsPlugin <span class=\"token operator\">=</span> <span class=\"token function\">require</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"tsconfig-paths-webpack-plugin\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></span>\nmodule<span class=\"token punctuation\">.</span><span class=\"token function-variable function\">exports</span> <span class=\"token operator\">=</span> <span class=\"token punctuation\">(</span><span class=\"token parameter\"><span class=\"token punctuation\">{</span> config <span class=\"token punctuation\">}</span></span><span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n  config<span class=\"token punctuation\">.</span>module<span class=\"token punctuation\">.</span>rules<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span>\n    test<span class=\"token punctuation\">:</span> <span class=\"token regex\">/\\.(ts|tsx)$/</span><span class=\"token punctuation\">,</span>\n    use<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span>\n      <span class=\"token punctuation\">{</span>\n        loader<span class=\"token punctuation\">:</span> require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"awesome-typescript-loader\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n      <span class=\"token comment\">// Optional</span>\n      <span class=\"token punctuation\">{</span>\n        loader<span class=\"token punctuation\">:</span> require<span class=\"token punctuation\">.</span><span class=\"token function\">resolve</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"react-docgen-typescript-loader\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  config<span class=\"token punctuation\">.</span>resolve<span class=\"token punctuation\">.</span>extensions<span class=\"token punctuation\">.</span><span class=\"token function\">push</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".ts\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\".tsx\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"gatsby-highlight-code-line\">  config<span class=\"token punctuation\">.</span>resolve<span class=\"token punctuation\">.</span>plugins <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">TsconfigPathsPlugin</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">{</span><span class=\"token punctuation\">}</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">;</span></span>  <span class=\"token keyword\">return</span> config<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Cool! But Typescript would still complain that type definition for the addons are missing, let’s add them:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D @types/storybook__addon-actions\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D @types/storybook__addon-links</code></pre></div>\n<h2>Setting up Testing</h2>\n<p>I’m thrilled to find out that there is an official integration between Storybook and Jest Snapshot Testing — more details <a href=\"https://storybook.js.org/docs/testing/structural-testing/\">here</a>. Let’s install them:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D @storybook/addon-storyshots\n<span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D @types/storybook__addon-storyshots <span class=\"token comment\"># if you are using Typescript</span></code></pre></div>\n<p><code class=\"language-text\">create-react-app</code> complains that the installed version of <code class=\"language-text\">jest</code> is not compatible. So similar trick to solve the incompatibility of <code class=\"language-text\">babel-loader</code>:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D jest@24.7.1 --exact</code></pre></div>\n<p>Aww snap! Running <code class=\"language-text\">yarn test</code> in the terminal results in:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Cannot <span class=\"token function\">find</span> module <span class=\"token string\">'react-test-renderer'</span> from <span class=\"token string\">'renderTree.js'</span></code></pre></div>\n<p>After searching, finally found someone in GitHub saying by installing <code class=\"language-text\">react-test-renderer</code> package solves the issue. Hence I did the same:</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\"><span class=\"token function\">yarn</span> <span class=\"token function\">add</span> -D react-test-renderer</code></pre></div>\n<p>And then… I run <code class=\"language-text\">yarn test</code> again, and now…</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">Error: EMFILE: too many <span class=\"token function\">open</span> files, <span class=\"token function\">watch</span></code></pre></div>\n<p>Oh God why…\nLuckily I found another guy on GitHub saying that installing <code class=\"language-text\">watchman</code> solves the issue, so again…</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">brew <span class=\"token function\">install</span> watchman</code></pre></div>\n<p>Yay! The tests are finally running ✨</p>\n<hr>\n<p><em>Written with 💌 by Yong Shean. I’m currently looking for a frontend engineering job, preferably remote, or based in Kuala Lumpur. I’m also open to opportunities to work outside of Malaysia, e.g. in the U.S. if visa is sponsored.</em></p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\">res<span class=\"token punctuation\">.</span><span class=\"token function\">end</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"title":"Setting up a React project","date":"May 20, 2019","description":"I'll show you how I bootstrapped my own version of create-react-app!"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/setting-up-react-project/","previous":{"fields":{"slug":"/automated-testing-with-cypress/"},"frontmatter":{"title":"Automated Testing with Cypress"}},"next":null}}